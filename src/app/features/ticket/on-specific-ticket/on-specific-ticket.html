<p>on-specific-ticket works!</p>

<div *ngIf="loading">
  <p>Loading ticket details...</p>
</div>

<div *ngIf="!loading && ticket">

  <div class="ticket-section">
    <h2>Ticket Details</h2>

    <p><b>Ticket ID:</b> {{ ticket.id }}</p>
    <p><b>Title:</b> {{ ticket.title }}</p>
    <p><b>Description:</b> {{ ticket.description }}</p>
    <p><b>Status:</b> {{ ticket.status }}</p>
    <div *ngIf="isAgent">
    <p><b>Priority:</b> {{ ticket.priority }}</p></div>
    <p><b>Created At:</b> {{ ticket.createdAt | date:'short' }}</p>
  </div>
  <div *ngIf="isAgent">
    <hr />
    <h3>Update Status</h3>

    <select [(ngModel)]="newStatus">
      <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
    </select>

    <button (click)="updateStatus()">Update Status</button>
  </div>
  <hr />

   <div class="ticket-section">
  <h3>Uploaded Files</h3>

  <p *ngIf="attachments.length === 0">No files uploaded</p>

  <div *ngFor="let file of attachments" style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
    <span>{{ file.fileName }}</span>
    <button (click)="downloadFile(file)" style="cursor: pointer;">
      Download
    </button>
  </div>
</div>

  <hr />

  <div class="ticket-section">
    <h3>Comments</h3>

    <button (click)="refreshComments()">
      Refresh Comments
    </button>

    <p *ngIf="comments.length === 0">
      No comments yet
    </p>

    <div *ngFor="let comment of comments" class="comment-box">
      <div *ngIf="!comment.internal || isAgent">
      <p><b>{{ comment.user }}</b></p>
      <p>{{ comment.text }}</p>
      <small>{{ comment.createdAt | date:'short' }}</small>
      <hr />
      </div>
    </div>
  </div>

</div>

<div *ngIf="isAgent || role === 'ROLE_USER'">

  <textarea
    [(ngModel)]="commentText"
    placeholder="Write comment">
  </textarea>

  <div *ngIf="isAgent">
    <label>
      <input type="checkbox" [(ngModel)]="isInternal" />
      Internal comment (agents only)
    </label>
  </div>

  <button (click)="addComment()">Add Comment</button>
</div>


<div *ngIf="!loading && !ticket">
  <p>Failed to load ticket details.</p>
</div>
